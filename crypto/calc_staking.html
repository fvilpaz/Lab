<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí∞ CryptoCalc Pro - WebView Optimizado</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary:#5294e2;
    --secondary:#7cbeff;
    --background:#383c4a;
    --card-bg:#2f343f;
    --text:#d3dae3;
    --text-muted:#8b91a0;
    --success:#73d216;
    --danger:#cc575d;
    --border:#404552;
    --input-bg:#404552;
    --shadow:rgba(0,0,0,0.3);
}
.dark-theme { --primary:#5294e2; --secondary:#7cbeff; --background:#383c4a; --card-bg:#2f343f; --text:#d3dae3; --text-muted:#8b91a0; --success:#73d216; --danger:#cc575d; --border:#404552; --input-bg:#404552; --shadow:rgba(0,0,0,0.3);}
.light-theme { --primary:#2c5282; --secondary:#4299e1; --background:#f0f8ff; --card-bg:#ffffff; --text:#2d3748; --text-muted:#718096; --success:#38a169; --danger:#e53e3e; --border:#e2e8f0; --input-bg:#ffffff; --shadow:rgba(0,0,0,0.1); }

* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width:1000px; margin:0 auto; padding:20px; background:var(--background); color:var(--text); transition: all 0.3s ease; min-height: 100vh;}
.header { display: flex; justify-content: space-between; align-items: center; padding: 25px 35px; margin-bottom: 30px; background: linear-gradient(135deg, #5294e2, #7cbeff); border-radius: 20px; color: white; box-shadow: 0 8px 20px rgba(0,0,0,0.3); position: relative; overflow: hidden; animation: gradient-move 15s ease infinite;}
.header::before { content: ""; position: absolute; width: 200%; height: 200%; background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1), transparent 60%); top: -50%; left: -50%; transform: rotate(45deg);}
.header h1 { font-size: 2.2rem; font-weight: 700; display: flex; align-items: center; gap: 15px; text-shadow: 1px 1px 6px rgba(0,0,0,0.4); z-index: 1; position: relative;}
.header h1 i { font-size: 2.5rem; color: #fff; animation: icon-bounce 2s infinite;}
@keyframes icon-bounce { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-6px); } }
@keyframes gradient-move {0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
.theme-toggle { background: rgba(255, 255, 255, 0.15); border: none; border-radius: 50%; width: 50px; height: 50px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; transition: all 0.4s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.25); z-index: 1; position: relative;}
.theme-toggle:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(45deg) scale(1.1); box-shadow: 0 8px 20px rgba(0,0,0,0.35);}
.card { background:var(--card-bg); padding:20px; margin:15px 0; border-radius:12px; box-shadow:0 3px 12px var(--shadow); border:1px solid var(--border);}
h2 { color:var(--primary); margin-top:0; border-bottom:2px solid var(--border); padding-bottom:8px; margin-bottom:15px;}
.form-grid-compact { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px;}
.input-icon-card { display:flex; align-items:center; background:var(--input-bg); border-radius:8px; padding:10px 12px; border:2px solid var(--border); gap:10px; transition: all 0.3s ease; position: relative;}
.input-icon-card i { color:var(--primary); min-width:20px; text-align:center; font-size: 1.1rem;}
.input-icon-card input, .input-icon-card select { flex:1; background:transparent; border:none; color:var(--text); font-size:15px; width: 100%;}
.input-icon-card input:focus, .input-icon-card select:focus { outline:none; border-color: var(--secondary);}
.input-icon-card:focus-within { border-color: var(--secondary); }
.btn-success { padding:12px 18px; border:none; border-radius:8px; font-size:16px; cursor:pointer; display:flex; align-items:center; gap:8px; justify-content:center; margin-top:10px; background:var(--success); color:white; transition: all 0.3s ease; width: 100%; font-weight: 600;}
.btn-success:hover{ transform:translateY(-2px); box-shadow:0 4px 10px var(--shadow);}
.btn-success.loading { opacity: 0.8; pointer-events: none; }
.resultados { background:var(--card-bg); padding:15px; border-radius:8px; margin-top:20px; border-left:4px solid var(--secondary);}
.resultado-item { display:flex; justify-content:space-between; margin:8px 0; padding:8px 10px; background:var(--input-bg); border-radius:6px; box-shadow:0 1px 4px var(--shadow);}
.resultado-item strong { color:var(--text);}
.chart-container { height:350px; margin-top:20px;}
.suggestions-container { position:relative; flex: 1;}
.suggestions-list { position:absolute; width:100%; max-height:200px; overflow-y:auto; background:var(--card-bg); border:1px solid var(--border); border-radius:8px; z-index:1000; margin-top:5px; box-shadow:0 4px 15px var(--shadow); left:0; top:100%;}
.suggestion-item { padding:10px; cursor:pointer; border-bottom:1px solid var(--border); transition: background 0.2s;}
.suggestion-item:hover { background:var(--primary); color:white;}
.mode-explanation { font-size:0.85rem; color:var(--text-muted); margin-top:5px; padding: 8px; background: var(--input-bg); border-radius: 6px;}
.manual-price-toggle { color: var(--primary); cursor: pointer; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px; margin-top: 8px; padding: 6px 10px; background: var(--input-bg); border-radius: 6px; transition: all 0.3s ease;}
.manual-price-toggle:hover { background: var(--primary); color: white;}
.manual-price-container { display: flex; align-items: center; gap: 10px; margin-top: 0; padding: 0; background: var(--input-bg); border-radius: 6px; transition: all 0.3s ease; max-height: 0; overflow: hidden; opacity: 0;}
.manual-price-container.visible { max-height: 60px; margin-top: 10px; padding: 10px; opacity: 1;}
.manual-price-container .input-icon-card { margin: 0; flex: 1;}
@media (max-width: 768px) { .header { padding: 20px; margin-bottom: 20px; } .header h1 { font-size: 1.8rem; } .header h1 i { font-size: 2rem; } .form-grid-compact { grid-template-columns: 1fr; gap: 12px; } .input-icon-card { padding: 8px 10px; } .theme-toggle { width: 45px; height: 45px; font-size: 1.3rem; } }
@media (max-width: 480px) { body { padding: 15px; } .header { padding: 15px; flex-direction: column; text-align: center; gap: 15px; } .header h1 { font-size: 1.6rem; } .card { padding: 15px; } .resultado-item { flex-direction: column; gap: 5px; } .chart-container { height: 300px; } }
@media (max-height: 500px) and (orientation: landscape) { body { padding: 10px; } .header { margin-bottom: 15px; padding: 15px; } .header h1 { font-size: 1.5rem; } .card { padding: 12px; margin: 10px 0; } .form-grid-compact { grid-template-columns: repeat(2, 1fr); gap: 10px; } .chart-container { height: 250px; } }
</style>
</head>
<body class="dark-theme">
<div class="header">
<h1><i class="fas fa-coins"></i> CryptoCalc Compact</h1>
<button class="theme-toggle" id="theme-toggle"><i class="fas fa-moon"></i></button>
</div>

<div class="card">
<h2>Calculadora de Staking</h2>
<div class="form-grid-compact">
<div class="input-icon-card">
<i class="fas fa-search"></i>
<div class="suggestions-container">
<input type="text" id="crypto-search" placeholder="Buscar criptomoneda...">
<div id="suggestions" class="suggestions-list" style="display:none;"></div>
</div>
</div>
<div class="input-icon-card">
<i class="fas fa-exchange-alt"></i>
<select id="calculation-mode">
<option value="usd">USD ‚Üí Cantidad</option>
<option value="crypto">Cantidad ‚Üí USD</option>
</select>
</div>
<div class="input-icon-card" id="usd-group">
<i class="fas fa-wallet"></i>
<input type="number" id="amount-input" step="0.01" placeholder="Tenencia en USD">
</div>
<div class="input-icon-card" id="crypto-group" style="display:none;">
<i class="fas fa-coins"></i>
<input type="number" id="crypto-amount" step="0.00000001" placeholder="Cantidad de cripto">
</div>
<div class="input-icon-card">
<i class="fas fa-percent"></i>
<input type="number" id="apr-input" step="0.01" placeholder="APR/APY (%)">
</div>
<div>
<div class="mode-explanation" id="mode-explanation-text">Introduce USD y calcula la cantidad de cripto</div>
<div class="manual-price-toggle" id="manual-price-toggle"><i class="fas fa-cog"></i> Configurar precio manual</div>
<div class="manual-price-container" id="manual-price-container">
<div class="input-icon-card">
<i class="fas fa-dollar-sign"></i>
<input type="number" id="manual-price" step="0.01" placeholder="Precio manual (opcional)">
</div>
</div>
<button class="btn-success" id="calculate-btn"><i class="fas fa-calculator"></i> Calcular</button>
</div>
</div>
</div>

<div class="card">
<h2>Resultados</h2>
<div class="resultados">
<div id="results-container"><div class="resultado-item"><span>Los resultados aparecer√°n aqu√≠</span></div></div>
</div>
</div>

<div class="card">
<h2>Distribuci√≥n de Ganancias</h2>
<div class="chart-container"><canvas id="earnings-chart"></canvas></div>
</div>

<script>
let cryptoData={}, earningsChart=null, isDarkTheme=true, currentPrice=0;
const themeToggle=document.getElementById('theme-toggle');
const cryptoSearch=document.getElementById('crypto-search');
const suggestions=document.getElementById('suggestions');
const calculationMode=document.getElementById('calculation-mode');
const amountInput=document.getElementById('amount-input');
const cryptoAmount=document.getElementById('crypto-amount');
const usdGroup=document.getElementById('usd-group');
const cryptoGroup=document.getElementById('crypto-group');
const aprInput=document.getElementById('apr-input');
const manualPrice=document.getElementById('manual-price');
const manualPriceToggle=document.getElementById('manual-price-toggle');
const manualPriceContainer=document.getElementById('manual-price-container');
const calculateBtn=document.getElementById('calculate-btn');
const resultsContainer=document.getElementById('results-container');
const modeExplanation=document.getElementById('mode-explanation-text');

document.addEventListener('DOMContentLoaded',()=>{
    ajustarAlturaWebView();
    configurarEventListeners();
    cargarDatosCripto();
});

function ajustarAlturaWebView(){
    document.body.style.minHeight=window.innerHeight+'px';
    window.addEventListener('resize',()=>{ document.body.style.minHeight=window.innerHeight+'px'; });
}

function configurarEventListeners(){
    themeToggle.addEventListener('click',toggleTheme);
    cryptoSearch.addEventListener('input',buscarCriptomonedas);
    cryptoSearch.addEventListener('focus',mostrarSugerencias);
    calculationMode.addEventListener('change',cambiarModoCalculo);
    calculateBtn.addEventListener('click',calcularStaking);
    manualPriceToggle.addEventListener('click', toggleManualPrice);
    
    document.addEventListener('click',e=>{
        if(!cryptoSearch.contains(e.target)&&!suggestions.contains(e.target)){ 
            suggestions.style.display='none'; 
        }
    });
}

function toggleTheme(){
    isDarkTheme=!isDarkTheme;
    if(isDarkTheme){
        document.body.classList.remove('light-theme');
        document.body.classList.add('dark-theme');
        themeToggle.innerHTML='<i class="fas fa-moon"></i>';
    }else{
        document.body.classList.remove('dark-theme');
        document.body.classList.add('light-theme');
        themeToggle.innerHTML='<i class="fas fa-sun"></i>';
    }
}

function toggleManualPrice() {
    manualPriceContainer.classList.toggle('visible');
    if(manualPriceContainer.classList.contains('visible')) {
        manualPriceToggle.innerHTML='<i class="fas fa-times"></i> Ocultar precio manual';
        manualPriceToggle.style.background='var(--primary)';
        manualPriceToggle.style.color='white';
    } else {
        manualPriceToggle.innerHTML='<i class="fas fa-cog"></i> Configurar precio manual';
        manualPriceToggle.style.background='var(--input-bg)';
        manualPriceToggle.style.color='var(--primary)';
        manualPrice.value='';
    }
}

async function cargarDatosCripto(){
    try{
        calculateBtn.classList.add('loading');
        calculateBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Cargando datos...';
        const response=await fetch('https://api.coingecko.com/api/v3/coins/list');
        const data=await response.json();
        cryptoData={};
        data.forEach(coin=>{cryptoData[coin.id]=coin;});
        calculateBtn.classList.remove('loading');
        calculateBtn.innerHTML='<i class="fas fa-calculator"></i> Calcular';
    }catch(e){
        console.error(e);
        calculateBtn.classList.remove('loading'); 
        calculateBtn.innerHTML='<i class="fas fa-calculator"></i> Calcular';
    }
}

function buscarCriptomonedas(){
    const searchTerm=cryptoSearch.value.toLowerCase();
    suggestions.innerHTML='';
    if(!searchTerm){suggestions.style.display='none'; return;}
    const matches=[];
    for(const [id,coin] of Object.entries(cryptoData)){
        if(id.toLowerCase().includes(searchTerm)||(coin.name&&coin.name.toLowerCase().includes(searchTerm))||(coin.symbol&&coin.symbol.toLowerCase().includes(searchTerm))){
            let score=0;
            if(coin.symbol&&coin.symbol.toLowerCase()===searchTerm){score+=100;}
            if(coin.name&&coin.name.toLowerCase()===searchTerm){score+=90;}
            const mainCoins=['bitcoin','ethereum','binancecoin','ripple','cardano','solana','dogecoin'];
            if(mainCoins.includes(id)){score+=80;}
            if(coin.name&&coin.name.toLowerCase().startsWith(searchTerm)){score+=70;}
            if(coin.symbol&&coin.symbol.toLowerCase().startsWith(searchTerm)){score+=60;}
            if(!id.includes('-')&&!id.includes(' ')){score+=50;}
            matches.push({coin,score});if(matches.length>=15)break;
        }
    }
    matches.sort((a,b)=>b.score-a.score);
    if(matches.length>0){
        const top=matches.slice(0,8);
        top.forEach(item=>{
            const div=document.createElement('div');
            div.className='suggestion-item';
            div.textContent=`${item.coin.name} (${item.coin.symbol?.toUpperCase()||'N/A'})`;
            div.onclick=()=>seleccionarCripto(item.coin.id);
            suggestions.appendChild(div);
        });
        suggestions.style.display='block';
    }else{suggestions.style.display='none';}
}

function mostrarSugerencias(){if(suggestions.children.length>0){suggestions.style.display='block';}}
function seleccionarCripto(id){cryptoSearch.value=id;suggestions.style.display='none';}

function cambiarModoCalculo(){
    const modo=calculationMode.value;
    if(modo==='usd'){
        usdGroup.style.display='flex'; 
        cryptoGroup.style.display='none'; 
        modeExplanation.textContent='Introduce USD y calcula la cantidad de cripto';
    } else {
        usdGroup.style.display='none'; 
        cryptoGroup.style.display='flex'; 
        modeExplanation.textContent='Introduce cantidad de cripto y calcula el valor en USD';
    }
}

async function calcularStaking(){
    const coinId=cryptoSearch.value.trim();
    const modo=calculationMode.value;
    const amount=parseFloat(amountInput.value);
    const cryptoAmountValue=parseFloat(cryptoAmount.value);
    const apr=parseFloat(aprInput.value);
    const manualPriceValue=manualPrice.value?parseFloat(manualPrice.value):null;
    
    if(!coinId){mostrarError('Selecciona una criptomoneda'); return;}
    if(modo==='usd'&&(isNaN(amount)||amount<=0)){mostrarError('Ingresa tenencia v√°lida en USD');return;}
    if(modo==='crypto'&&(isNaN(cryptoAmountValue)||cryptoAmountValue<=0)){mostrarError('Ingresa cantidad v√°lida de cripto');return;}
    if(isNaN(apr)||apr<=0){mostrarError('Ingresa APR/APY v√°lido');return;}
    
    try{
        calculateBtn.classList.add('loading');
        calculateBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Calculando...';
        let price, source;
        
        if(manualPriceValue){
            price=manualPriceValue;
            source='precio manual';
        } else {
            const priceResp=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`);
            const priceData=await priceResp.json();
            if(!priceData[coinId]){throw new Error('Criptomoneda no encontrada');}
            price=priceData[coinId].usd;
            source='CoinGecko';
        }
        
        currentPrice=price;
        let usdValue, cryptoQuantity;
        
        if(modo==='usd'){
            usdValue=amount; 
            cryptoQuantity=amount/price;
        } else {
            cryptoQuantity=cryptoAmountValue; 
            usdValue=cryptoAmountValue*price;
        }
        
        const dailyRate=apr/36500;
        const dailyEarnings=usdValue*dailyRate;
        const weeklyEarnings=dailyEarnings*7;
        const monthlyEarnings=dailyEarnings*30;
        const annualEarnings=dailyEarnings*365;
        
        mostrarResultados({
            coin:coinId,
            price,
            source,
            usdValue,
            cryptoQuantity,
            apr,
            dailyEarnings,
            weeklyEarnings,
            monthlyEarnings,
            annualEarnings,
            modo
        });
        
        actualizarGrafico(dailyEarnings,weeklyEarnings,monthlyEarnings,annualEarnings);
        
    } catch(e) {
        mostrarError(`Error: ${e.message}`);
    } finally {
        calculateBtn.classList.remove('loading'); 
        calculateBtn.innerHTML='<i class="fas fa-calculator"></i> Calcular';
    }
}

function mostrarResultados(data){
    resultsContainer.innerHTML=`
        <div class="resultado-item"><span><strong>${data.coin.toUpperCase()}</strong> - Precio: $${data.price.toFixed(2)} (${data.source})</span></div>
        <div class="resultado-item"><span>${data.modo==='usd'?'Inversi√≥n (USD):':'Cantidad de cripto:'}</span><strong>${data.modo==='usd'?'$'+data.usdValue.toFixed(2):data.cryptoQuantity.toFixed(8)}</strong></div>
        <div class="resultado-item"><span>${data.modo==='usd'?'Cantidad de cripto:':'Valor en USD:'}</span><strong>${data.modo==='usd'?data.cryptoQuantity.toFixed(8):'$'+data.usdValue.toFixed(2)}</strong></div>
        <div class="resultado-item"><span>APR/APY:</span><strong>${data.apr.toFixed(2)}%</strong></div>
        <div class="resultado-item"><span>Ganancias diarias:</span><strong>$${data.dailyEarnings.toFixed(2)}</strong></div>
        <div class="resultado-item"><span>Ganancias semanales:</span><strong>$${data.weeklyEarnings.toFixed(2)}</strong></div>
        <div class="resultado-item"><span>Ganancias mensuales:</span><strong>$${data.monthlyEarnings.toFixed(2)}</strong></div>
        <div class="resultado-item"><span>Ganancias anuales:</span><strong>$${data.annualEarnings.toFixed(2)}</strong></div>
    `;
}

function mostrarError(msg){
    resultsContainer.innerHTML=`
        <div class="resultado-item" style="color: var(--danger);">
            <i class="fas fa-exclamation-triangle"></i>
            <span>${msg}</span>
        </div>
    `;
}

function actualizarGrafico(daily,weekly,monthly,annual){
    const ctx=document.getElementById('earnings-chart').getContext('2d');
    if(earningsChart){earningsChart.destroy();}
    
    if(daily===0&&weekly===0&&monthly===0&&annual===0){
        earningsChart=new Chart(ctx,{
            type:'bar',
            data:{labels:['Calcula staking para ver ganancias'],datasets:[{data:[1],backgroundColor:['rgba(100,100,100,0.1)'],borderWidth:0}]},
            options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{enabled:false},title:{display:true,text:'Esperando datos...',color:getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),font:{size:16}}},scales:{y:{display:false},x:{display:false}}}
        });
        return;
    }
    
    const colores=['rgba(82,148,226,0.9)','rgba(114,190,255,0.9)','rgba(124,190,255,0.9)','rgba(124,210,255,0.9)'];
    earningsChart=new Chart(ctx,{
        type:'bar',
        data:{labels:['Diario','Semanal','Mensual','Anual'],datasets:[{label:'Ganancias en USD',data:[daily,weekly,monthly,annual],backgroundColor:colores,borderColor:['rgb(82,148,226)','rgb(114,190,255)','rgb(124,190,255)','rgb(124,210,255)'],borderWidth:2}]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{color:getComputedStyle(document.documentElement).getPropertyValue('--text'),font:{size:12}}},tooltip:{callbacks:{label:function(ctx){return `Ganancias: $${ctx.raw.toFixed(2)}`}}},title:{display:true,text:'Distribuci√≥n de Ganancias',color:getComputedStyle(document.documentElement).getPropertyValue('--text'),font:{size:16,weight:'bold'}}},scales:{y:{beginAtZero:true,ticks:{color:getComputedStyle(document.documentElement).getPropertyValue('--text'),callback:function(value){return '$'+value.toFixed(2);}},grid:{color:getComputedStyle(document.documentElement).getPropertyValue('--border')},title:{display:true,text:'USD ($)',color:getComputedStyle(document.documentElement).getPropertyValue('--text')}},x:{ticks:{color:getComputedStyle(document.documentElement).getPropertyValue('--text')},grid:{color:getComputedStyle(document.documentElement).getPropertyValue('--border')}}}}
    });
}
</script>
</body>
</html>
